import { useState, useRef } from "react";

export default function App() {
  const [page, setPage] = useState("home");
  const [role, setRole] = useState("Tenant");
  const [messages, setMessages] = useState([
    { from: "Agent", text: "Hello, the house is available." },
    { from: "You", text: "Great! Can I visit tomorrow?" },
  ]);
  const [input, setInput] = useState("");

  const properties = [
    { id: 1, title: "2 Bedroom Apartment", price: "$500/month", location: "Harare", lat: -17.8252, lng: 31.0335 },
    { id: 2, title: "Modern House", price: "$900/month", location: "Bulawayo", lat: -20.1500, lng: 28.5830 },
  ];

  const mapRef = useRef(null);

  const sendMessage = () => {
    if (!input) return;
    setMessages([...messages, { from: "You", text: input }]);
    setInput("");
  };

  return (
    <div style={{ fontFamily: "Arial", minHeight: "100vh", background: "#f3f4f6" }}>
      {/* HEADER */}
      <div style={{ padding: 15, background: "#111827", color: "white" }}>
        <h2>üè† Estate-Connect</h2>
        <small>Role: <b>{role}</b></small>
      </div>

      {/* NAV */}
      <div style={{ display: "flex", justifyContent: "space-around", padding: 10, background: "#e5e7eb" }}>
        <button onClick={() => setPage("home")}>Home</button>
        <button onClick={() => setPage("map")}>Map</button>
        <button onClick={() => setPage("chat")}>Chat</button>
        <button onClick={() => setPage("post")}>Post</button>
        <button onClick={() => setPage("profile")}>Profile</button>
      </div>

      {/* CONTENT */}
      <div style={{ padding: 15 }}>
        {/* HOME */}
        {page === "home" && (
          <>
            <h3>Featured Properties</h3>
            {properties.map(p => (
              <div key={p.id} style={{ background: "white", padding: 10, marginBottom: 10, borderRadius: 8 }}>
                <h4>{p.title}</h4>
                <p>{p.price}</p>
                <small>{p.location}</small>
              </div>
            ))}
          </>
        )}

        {/* MAP */}
        {page === "map" && (
          <>
            <h3>World Map (Google Satellite)</h3>
            <div
              style={{ height: 300, width: "100%", borderRadius: 8 }}
              ref={(el) => {
                if (!el || window.mapInitialized) return;
                window.mapInitialized = true;

                const map = new window.google.maps.Map(el, {
                  center: { lat: -18.0, lng: 30.0 },
                  zoom: 6,
                  mapTypeId: "satellite",
                });

                properties.forEach((p) => {
                  const marker = new window.google.maps.Marker({
                    position: { lat: p.lat, lng: p.lng },
                    map,
                    title: p.title,
                  });

                  const infoWindow = new window.google.maps.InfoWindow({
                    content: `<div><b>${p.title}</b><br/>${p.price}<br/>${p.location}</div>`,
                  });

                  marker.addListener("click", () => infoWindow.open(map, marker));
                });
              }}
            />

            <h4 style={{ marginTop: 15 }}>Property List</h4>
            {properties.map(p => (
              <div key={p.id} style={{ background: "white", padding: 8, marginTop: 8 }}>
                {p.title} ‚Äì {p.location}
              </div>
            ))}
          </>
        )}

        {/* CHAT */}
        {page === "chat" && (
          <>
            <h3>Chat</h3>
            <div style={{ background: "white", padding: 10, height: 200, overflowY: "auto", borderRadius: 8 }}>
              {messages.map((m, i) => (
                <div key={i} style={{ textAlign: m.from === "You" ? "right" : "left" }}>
                  <p><b>{m.from}:</b> {m.text}</p>
                </div>
              ))}
            </div>

            <div style={{ display: "flex", marginTop: 10 }}>
              <input
                value={input}
                onChange={e => setInput(e.target.value)}
                placeholder="Type a message"
                style={{ flex: 1, padding: 8 }}
              />
              <button onClick={sendMessage}>Send</button>
            </div>
          </>
        )}

        {/* POST */}
        {page === "post" && (
          <>
            <h3>Post / Promote Property</h3>
            <input placeholder="Title" style={{ width: "100%", marginBottom: 8 }} />
            <input placeholder="Price" style={{ width: "100%", marginBottom: 8 }} />
            <textarea placeholder="Description" style={{ width: "100%", marginBottom: 8 }} />

            <label style={{ display: "block", marginBottom: 8 }}>
              <input type="checkbox" /> Promote as Premium
            </label>

            <label style={{ display: "block", marginBottom: 8 }}>
              Video URL: <input type="text" placeholder="https://..." style={{ width: "100%" }} />
            </label>

            <button
              onClick={() => alert("Property Published! (Demo, no backend yet)")}
            >
              Publish
            </button>

            <button
              style={{ marginTop: 5 }}
              onClick={() => navigator.clipboard.writeText(window.location.href)}
            >
              Share Property
            </button>
          </>
        )}

        {/* PROFILE */}
        {page === "profile" && (
          <>
            <h3>Profile</h3>
            <p><b>Name:</b> Pashall KAMANGA</p>
            <p><b>Email:</b> swag60693@gmail.com</p>
            <p><b>Phone:</b> 0773759613</p>

            <h4>Change Role</h4>
            <select value={role} onChange={e => setRole(e.target.value)}>
              <option>Tenant</option>
              <option>Landlord</option>
              <option>Agent</option>
              <option>Company</option>
            </select>

            <h4 style={{ marginTop: 20 }}>Settings</h4>
            <label><input type="checkbox" /> Enable notifications</label>
            <br/>
            <label><input type="checkbox" /> Show premium properties only</label>

            <h4 style={{ marginTop: 20 }}>About Estate-Connect</h4>
            <p>
              Estate-Connect is a global real estate platform connecting tenants,
              landlords, agents, and companies through maps, chat, and smart promotion.
            </p>
          </>
        )}

      </div>
    </div>
  );
}import { useState, useEffect } from "react";
import { MapContainer, TileLayer, Marker, Popup, useMapEvents } from "react-leaflet";
import L from "leaflet";
import "leaflet/dist/leaflet.css";

// Fix leaflet icons
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",
  iconUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",
  shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
});

// Role constants
const ROLES = {
  LANDLORD: "Landlord",
  AGENT: "Agent",
  TENANT: "Tenant",
};

export default function App() {
  // Pages
  const [page, setPage] = useState("home");

  // User data
  const userData = JSON.parse(localStorage.getItem("estateUser")) || {};
  const userRole = userData.role || ROLES.TENANT;
  const userName = userData.name || "Guest";

  // Markers (properties)
  const [markers, setMarkers] = useState([]);

  // Filter
  const [availabilityFilter, setAvailabilityFilter] = useState("All");

  // Chat
  const [messages, setMessages] = useState([]);
  const [text, setText] = useState("");

  // Permissions
  const permissions = {
    [ROLES.LANDLORD]: { addProperty: true, chatWith: [ROLES.AGENT] },
    [ROLES.AGENT]: { addProperty: false, chatWith: [ROLES.LANDLORD, ROLES.TENANT] },
    [ROLES.TENANT]: { addProperty: false, chatWith: [ROLES.AGENT] },
  };

  useEffect(() => {
    const savedMarkers = localStorage.getItem("estateMarkers");
    if (savedMarkers) setMarkers(JSON.parse(savedMarkers));

    const savedMessages = localStorage.getItem("estateChats");
    if (savedMessages) setMessages(JSON.parse(savedMessages));
  }, []);

  function login(e) {
    e.preventDefault();
    const data = {
      name: e.target.name.value,
      role: e.target.role.value,
    };
    localStorage.setItem("estateUser", JSON.stringify(data));
    window.location.reload();
  }

  function sendMessage(e) {
    e.preventDefault();
    if (!text) return;
    const msg = {
      from: userName,
      role: userRole,
      text,
      time: new Date().toLocaleTimeString(),
    };
    const updated = [...messages, msg];
    setMessages(updated);
    localStorage.setItem("estateChats", JSON.stringify(updated));
    setText("");
  }

  // Map click logic
  function MapClicker() {
    useMapEvents({
      click(e) {
        if (!permissions[userRole]?.addProperty) {
          alert("Only landlords can add property locations");
          return;
        }
        const newMarker = {
          lat: e.latlng.lat,
          lng: e.latlng.lng,
          owner: userName,
          role: userRole,
          price: prompt("Enter monthly rent price"),
          availability: prompt("Availability: this month or next month"),
          description: prompt("Short property description"),
        };
        const updated = [...markers, newMarker];
        setMarkers(updated);
        localStorage.setItem("estateMarkers", JSON.stringify(updated));
      },
    });
    return null;
  }

  if (!userData.name) {
    return (
      <div style={{ padding: 20 }}>
        <h1>Estate-Connect</h1>
        <form onSubmit={login}>
          <input name="name" placeholder="Your name" required /><br /><br />
          <select name="role">
            <option>{ROLES.LANDLORD}</option>
            <option>{ROLES.AGENT}</option>
            <option>{ROLES.TENANT}</option>
          </select><br /><br />
          <button>Enter</button>
        </form>
      </div>
    );
  }

  return (
    <div style={{ fontFamily: "Arial" }}>
      {/* Header */}
      <header style={{ padding: 15, background: "#0f172a", color: "#fff" }}>
        <h2>Estate-Connect</h2>
        <div style={{ fontSize: "12px", opacity: 0.8 }}>
          Logged in as: {userName} ({userRole})
        </div>
        <button onClick={() => setPage("home")}>Home</button>{" "}
        <button onClick={() => setPage("map")}>World Map</button>{" "}
        <button onClick={() => setPage("chat")}>Chat</button>{" "}
        <button onClick={() => setPage("about")}>About</button>
      </header>

      {/* Home Page */}
      {page === "home" && (
        <div>
          <img
            src="https://images.unsplash.com/photo-1568605114967-8130f3a36994"
            style={{ width: "100%", height: "260px", objectFit: "cover" }}
          />
          <div style={{ padding: 20 }}>
            <h2>Find Your Perfect Home</h2>
            <p>
              Estate-Connect brings landlords, agents and tenants together
              through direct communication and smart property discovery.
            </p>
          </div>
        </div>
      )}

      {/* Map Page */}
      {page === "map" && (
        <div>
          <MapContainer
            center={[0, 0]}
            zoom={2}
            style={{ height: "60vh", width: "100%" }}
          >
            <TileLayer
              url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
              attribution="¬© OpenStreetMap contributors"
            />
            <MapClicker />
            {markers.map((m, i) => {
              m.price = m.price || "Not set";
              m.availability = m.availability || "Unknown";
              m.description = m.description || "No description";
              m.owner = m.owner || "Unknown";
              return (
                <Marker key={i} position={[m.lat, m.lng]}>
                  <Popup>
                    Property Location<br />
                    <b>Owner:</b> {m.owner}<br />
                    <b>Price:</b> {m.price}<br />
                    <b>Available:</b> {m.availability}<br />
                    <b>Description:</b> {m.description}
                  </Popup>
                </Marker>
              );
            })}
          </MapContainer>

          {/* Role badge */}
          <div style={{ padding: 10, background: "#e5e7eb" }}>
            <b>Your role:</b> {userRole}
          </div>

          {/* Property list with filter */}
          <div style={{ padding: 10, maxHeight: "200px", overflowY: "auto", borderTop: "1px solid #ccc" }}>
            <h3>Property List</h3>
            <div style={{ marginBottom: 10 }}>
              <label>Filter by availability: </label>
              <select value={availabilityFilter} onChange={e => setAvailabilityFilter(e.target.value)}>
                <option>All</option>
                <option>This month</option>
                <option>Next month</option>
              </select>
            </div>
            {markers
              .filter(m => availabilityFilter === "All" || m.availability === availabilityFilter)
              .map((m, i) => (
                <div key={i} style={{ padding: 5, marginBottom: 5, background: "#f9f9f9", borderRadius: 5 }}>
                  <b>Owner:</b> {m.owner} ({m.role})<br />
                  <b>Price:</b> {m.price}<br />
                  <b>Available:</b> {m.availability}<br />
                  <b>Description:</b> {m.description}
                </div>
              ))}
          </div>
        </div>
      )}

      {/* Chat Page */}
      {page === "chat" && (
        <div style={{ padding: 15 }}>
          <h3>Chat</h3>
          <div style={{
            border: "1px solid #ccc",
            height: 300,
            overflowY: "auto",
            padding: 10,
            background: "#f0f0f0"
          }}>
            {messages.map((m, i) => (
              <div key={i} style={{ marginBottom: 10, textAlign: m.from === userName ? "right" : "left" }}>
                <div style={{
                  display: "inline-block",
                  background: m.from === userName ? "#dcf8c6" : "#fff",
                  padding: 8,
                  borderRadius: 8,
                  maxWidth: "80%"
                }}>
                  <small>{m.from} ({m.role})</small>
                  <div>{m.text}</div>
                  <small>{m.time}</small>
                </div>
              </div>
            ))}
          </div>
          <form onSubmit={sendMessage} style={{ display: "flex", marginTop: 10 }}>
            <input
              value={text}
              onChange={(e) => setText(e.target.value)}
              placeholder="Type a message"
              style={{ flex: 1, padding: 8 }}
            />
            <button>Send</button>
          </form>
        </div>
      )}

      {/* About Page */}
      {page === "about" && (
        <div style={{ padding: 20 }}>
          <h2>About Estate-Connect</h2>
          <p>
            Estate-Connect is a global real-estate platform connecting landlords,
            agents, and tenants using map-based discovery.
          </p>
          <h3>Developer Information</h3>
          <p><b>Developer:</b> Pashall KAMANGA</p>
          <p><b>Phone:</b> 0773759613</p>
          <p><b>Email:</b> swag60693@gmail.com</p>
        </div>
      )}
    </div>
  );
}

